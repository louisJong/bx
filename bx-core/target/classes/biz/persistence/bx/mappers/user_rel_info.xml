<?xml version="1.0" encoding= "UTF-8" ?>        
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="user_rel_info">
<resultMap id="user_rel_info" type="com.baojing.credit.model.UserRelInfo">
	<result column="id" property="id"/>
	<result column="main_user_id" property="mainUserId"/>
	<result column="main_user_name" property="mainUserName"/>
	<result column="sub_user_id" property="subUserId"/>
	<result column="sub_user_name" property="subUserName"/>
	<result column="create_user" property="createUser"/>
	<result column="create_time" property="createTime"/>
	<result column="update_time" property="updateTime"/>
</resultMap>
<select id="findById" parameterType="long"  resultMap="user_rel_info">
	select * 	from user_rel_info where id=#{id}  
</select>  
<select id="querySubUsers" parameterType="long"  resultType="map">
	select rel.sub_user_id subUserId , rel.sub_user_name subUserName	from user_rel_info rel , admin_user user where rel.main_user_id=user.id and user.id=#{userId} and user.user_type='MAIN'
</select>  
<select id="querySubAcctCount" parameterType="long" resultType="long">
	select count(1) from user_rel_info where main_user_id=#{mainUserId}
</select>
<insert id="insert"  parameterType="com.baojing.credit.model.UserRelInfo"  useGeneratedKeys="true" keyProperty="id">
	insert into user_rel_info(id ,main_user_id ,main_user_name ,sub_user_id ,sub_user_name ,create_user ,create_time ,update_time)
   values(#{id,jdbcType=INTEGER} ,#{mainUserId,jdbcType=INTEGER} ,#{mainUserName,jdbcType=VARCHAR} ,#{subUserId,jdbcType=INTEGER} ,#{subUserName,jdbcType=VARCHAR} ,#{createUser,jdbcType=VARCHAR} ,#{createTime,jdbcType=TIMESTAMP} ,#{updateTime,jdbcType=TIMESTAMP}) 
</insert>
<insert id="batchInsert"  parameterType="list">
	insert into user_rel_info(id ,main_user_id ,main_user_name ,sub_user_id ,sub_user_name ,create_user ,create_time ,update_time)
   values
	<foreach collection="list" item="item" index="index"   separator=","> 
    (#{item.id,jdbcType=INTEGER} ,#{item.mainUserId,jdbcType=INTEGER} ,#{item.mainUserName,jdbcType=VARCHAR} ,#{item.subUserId,jdbcType=INTEGER} ,#{item.subUserName,jdbcType=VARCHAR} ,#{item.createUser,jdbcType=VARCHAR} ,#{item.createTime,jdbcType=TIMESTAMP} ,#{item.updateTime,jdbcType=TIMESTAMP})
	</foreach> 
</insert>
<update id="update"	parameterType="com.baojing.credit.model.UserRelInfo">
	update user_rel_info
<set>
	<if test="mainUserName != null">main_user_name=#{mainUserName},</if>
	<if test="subUserId != null">sub_user_id=#{subUserId},</if>
	<if test="subUserName != null">sub_user_name=#{subUserName},</if>
	<if test="updateTime != null">update_time=#{updateTime}</if>
</set>
	where id=#{id}
</update>
<delete id="deleteRecord" parameterType="hashmap">
	delete from user_rel_info where sub_user_id=#{subUserId} and main_user_id=#{mainUserId}
</delete>
</mapper>
